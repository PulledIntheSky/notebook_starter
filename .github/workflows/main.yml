name: Firefox Screenshot

on:
  push:
    branches:
      - main  # Adjust branch name as needed

jobs:
  take_screenshot:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v1

      - name: Build the Docker image
        run: docker build -t firefox-container .

      - name: Run Firefox in Docker
        run: |
          docker run -d --rm \
            --name firefox \
            -e DISPLAY=:99 \
            -v /tmp/.X11-unix:/tmp/.X11-unix \
            firefox-container

      - name: Wait for Firefox to start
        run: sleep 10

      - name: Take screenshot
        run: |
          docker exec $(docker ps -qf "name=firefox") firefox --screenshot /tmp/screenshot.png https://www.whatismyipaddress.com
          docker cp $(docker ps -qf "name=firefox"):/tmp/screenshot.png ./screenshots/screenshot.png

      - name: Stop and remove Firefox container
        run: docker stop $(docker ps -qf "name=firefox")

      - name: Upload screenshot artifact
        uses: actions/upload-artifact@v2
        with:
          name: firefox-screenshot
          path: screenshots/screenshot.png
